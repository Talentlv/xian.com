var app={root:"",uri:"/index.php"};$(function(){app.init()});app.init=function(){$("[anchor]").click(function(){$($(this).attr("anchor"))[0].scrollIntoView(true)})};app.tools={};app.tools.get=function(b,c,d,a){d=arguments[2]?arguments[2]:function(){};a=arguments[3]?arguments[3]:function(){};$.ajax({url:b,type:"get",dataType:"json",data:c,success:function(e){if(d){d.call(this,e)}},error:function(e,f){if(a){a.call(this,f.responseText)}}})};app.tools.post=function(b,c,d,a){d=arguments[2]?arguments[2]:function(){};a=arguments[3]?arguments[3]:function(){};$.ajax({url:b,type:"get",dataType:"json",data:c,success:function(e){if(d){d.call(this,e)}},error:function(e,f){if(a){a.call(this,f.responseText)}}})};app.tools.addFavorite=function(){var a=window.location;var d=document.title;var b=navigator.userAgent.toLowerCase();if(b.indexOf("360se")>-1){return app.tools.info("由于360浏览器功能限制，请按 Ctrl+D 手动收藏！")}else{if(b.indexOf("msie 8")>-1){window.external.AddToFavoritesBar(a,d)}else{if(document.all){try{window.external.addFavorite(a,d)}catch(c){return app.tools.info("您的浏览器不支持，请按 Ctrl+D 手动收藏!")}}else{if(window.sidebar){window.sidebar.addPanel(d,a,"")}else{return app.tools.info("您的浏览器不支持，请按 Ctrl+D 手动收藏!")}}}}};app.tools.setHome=function(d,b){d=d?d:this;b=b?b:window.location;try{d.style.behavior="url(#default#homepage)";d.setHomePage(b)}catch(c){if(window.netscape){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");var a=Components.classes["@mozilla.org/preferences-service;1"].getService(Components.interfaces.nsIPrefBranch);a.setCharPref("browser.startup.homepage",b)}catch(c){return app.tools.info("此操作被浏览器拒绝！请在浏览器地址栏输入“about:config”并回车，然后将[signed.applets.codebase_principal_support]设置为'true'",null,5000)}}}};app.tools.async=function(c,d,a){d=arguments[1]?arguments[1]:function(){};a=arguments[2]?arguments[2]:function(){};var b=function(f,e){if(f.length<1){return a.call(this)}e(f.shift(),function(){b(f,e)})};b(c,d)};app.tools.info=function(b,c,a){c=c?c:function(){};a=a?a:1500;$('<div class="hs-app-mask"><div class="hs-app-info">'+b+"</div></div>").appendTo($("body")).fadeIn("normal",function(){var d=this;setTimeout(function(){$(d).fadeOut("slow",function(){$(d).remove();c.call(this)})},a)})};app.tools.error=function(b,c,a){c=c?c:function(){};a=a?a:1500;$('<div class="hs-app-mask"><div class="hs-app-error">'+b+"</div></div>").appendTo($("body")).fadeIn("normal",function(){var d=this;setTimeout(function(){$(d).fadeOut("slow",function(){$(d).remove();c.call(this)})},a)})};app.tools.extend=function(d,c){$.each(c,function(b,a){if($.isArray(d[b])){d[b].push(a[0])}else{if($.isPlainObject(d[b])){app.tools.extend(d[b],a)}else{d[b]=a}}})};app.tools.formjson=function(b,d){var c=d;if(d instanceof jQuery){c={};var a=d.is("form")?d.serializeArray():d.find("input:enabled,select:enabled,textarea:enabled").serializeArray();$(a).each(function(){var h=this.name.split("[");var e=this.value;var f=h[0];while(n=h.pop()){n=n.replace(/\]$/,"");if(n==""){e=[e]}else{var g={};g[n]=e;e=g}}app.tools.extend(c,e)})}app.tools.extend(b,c);return b};app.tools.file2url=function(b){var a=null;if(window.createObjectURL!=undefined){a=window.createObjectURL(b)}else{if(window.URL!=undefined){a=window.URL.createObjectURL(b)}else{if(window.webkitURL!=undefined){a=window.webkitURL.createObjectURL(b)}}}return a};app.tools.regx=function(value,pattern){switch(pattern.toLowerCase()){case"required":pattern=/\S+/;break;case"id":pattern=/^[a-zA-Z][a-zA-Z0-9_-]*$/;break;case"name":pattern=/^[\u4e00-\u9fa5]{2,15}$/;break;case"email":pattern=/^\w+([-+.]\w+)*@\w+([-.]\w+)+$/;break;case"qq":pattern=/^[1-9][0-9]{4,}$/;break;case"ip":pattern=/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/;break;case"zip":pattern=/^\d{6}$/;break;case"phone":pattern=/^(\d{3,4}-?)?\d{7,8}(-\d{3})*$/;break;case"mobile":pattern=/^([0-9]{2,4})?1\d{10}$/;break;case"url":pattern=/^[a-zA-z]+:\/\/(\w+(-\w+)*)(\.(\w+(-\w+)*))+(\/?\S*)?$/;break;case"idcard":pattern=/^\d{16}[\dxX]{2}$/;break;case"int":pattern=/^-?\d+$/;break;case"float":pattern=/^(-)?\d+\.?\d*$/;break;case"bool":pattern=/^[01]$/;break;case"date":pattern=/^(?:(?!0000)[0-9]{4}-(?:(?:0[1-9]|1[0-2])-(?:0[1-9]|1[0-9]|2[0-8])|(?:0[13-9]|1[0-2])-(?:29|30)|(?:0[13578]|1[02])-31)|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)-02-29)$/;break;case"datetime":pattern=/^(?:(?!0000)[0-9]{4}-(?:(?:0[1-9]|1[0-2])-(?:0[1-9]|1[0-9]|2[0-8])|(?:0[13-9]|1[0-2])-(?:29|30)|(?:0[13578]|1[02])-31)|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)-02-29) (?:(?:[0-1][0-9])|(?:2[0-3])):(?:[0-5][0-9]):(?:[0-5][0-9])$/;break;default:try{pattern=eval(pattern)}catch(e){pattern=null}}var flag=false;if(typeof pattern=="string"){if(pattern.toLowerCase().substring(0,6)=="remote"){var url=pattern.substring(7).repalce("{value}",value);var result=$.ajax({url:url,async:false,cache:false,dataType:"json",data:data,success:function(result){if(result.status){flag=true}}}).responseText;if(result=="true"){flag=true}}else{if(pattern.toLowerCase().substring(0,6)=="length"){var v=pattern.substring(7).split(",");v[0]=parseFloat(v[0]);v[1]=parseFloat(v[1]);if(v[0]&&value.length>=v[0]){flag=true}if(flag&&v[1]&&value.length<=v[1]){flag=true}}else{if(pattern.toLowerCase().substring(0,5)=="value"){var v=pattern.substring(6).split(",");v[0]=parseFloat(v[0]);v[1]=parseFloat(v[1]);if(v[0]&&parseFloat(value)>=v[0]){flag=true}if(flag&&v[1]&&parseFloat(value)<=v[1]){flag=true}}}}}else{if(pattern&&pattern.test(value)){flag=true}}return flag};app.tools.formverify=function(b,c){var a=true;$(b).find("input[pattern]:enabled,select[pattern]:enabled,textarea[pattern]:enabled").each(function(){if(!app.tools.regx($(this).val(),$(this).attr("pattern"))){a=false;c.call(this,false)}});return a};app.login={status:false,info:{},ajaxcall:null,callbacks:[],exec:function(a){if(app.login.status){a.call()}else{app.login.ajaxcall=a;app.login.ajax()}},register:function(a){app.login.callbacks.push(a)},code:function(b){var a="/index.php?m=member&c=login&a=code&time="+new Date().getTime();b.attr("src",a)},check:function(a,b){$.ajax({url:"/index.php?m=member&c=login&a=json",type:"get",dataType:"json",success:function(c){app.login.status=c.status;app.login.info=c;if(a){a.call(this,c)}if(c.status){$(app.login.callbacks).each(function(){this()})}},error:function(c,d){if(b){b.call(this,d.responseText)}}})},ajax:function(){return app.tools.info("请配置 app.login.ajax( function ) 接口!")},submit:function(e,b,c,d,a){if(!e||!b){if(a){a.call(this,"用户名和密码不能为空")}return false}$.ajax({url:"/index.php?m=member&c=login&a=submit",type:"post",data:{username:e,password:b,code:c},dataType:"json",success:function(f){app.login.status=f.status;app.login.info=f;if(f.status&&app.login.ajaxcall){app.login.ajaxcall.call()}if(d){d.call(this,f)}},error:function(f,g){if(a){a.call(this,g.responseText)}}})}};app.login.mobile={send:function(c,d,a,b){if(!c){if(b){b.call(this,"手机号不能为空")}return false}$.ajax({url:"/index.php?m=member&c=mobile&a=send",type:"post",data:{mobile:c,code:d},dataType:"json",success:function(e){if(a){a.call(this,e)}},error:function(e,f){if(b){b.call(this,f.responseText)}}})},code:function(b){var a="/index.php?m=member&c=mobile&a=code&time="+new Date().getTime();b.attr("src",a)},submit:function(b,c,d,a){if(!b||!c){if(a){a.call(this,"手机号和短信验证码不能为空")}return false}$.ajax({url:"/index.php?m=member&c=mobile&a=submit",type:"post",data:{mobile:b,safecode:c},dataType:"json",success:function(e){app.login.status=e.status;app.login.info=e;if(e.status&&app.login.ajaxcall){app.login.ajaxcall.call()}if(d){d.call(this,e)}},error:function(e,f){if(a){a.call(this,f.responseText)}}})}};app.register={status:false,info:{},check:function(c,a,b){if(!c){if(b){b.call(this,"用户名不能为空")}return false}$.ajax({url:"/index.php?m=member&c=register&a=check",type:"post",data:{name:c},dataType:"json",success:function(d){if(a){a.call(this,d)}},error:function(d,e){if(b){b.call(this,e.responseText)}}})},send:function(c,d,a,b){if(!c||!d){if(b){b.call(this,"用户名和验证码不能为空")}return false}$.ajax({url:"/index.php?m=member&c=register&a=send",type:"post",data:{name:c,code:d},dataType:"json",success:function(e){if(a){a.call(this,e)}},error:function(e,f){if(b){b.call(this,f.responseText)}}})},code:function(b){var a="/index.php?m=member&c=register&a=code&time="+new Date().getTime();b.attr("src",a);return},submit:function(c,b,d,e,a){if(!c||!b||!d){if(a){a.call(this,"用户名、密码和验证码不能为空")}return false}$.ajax({url:"/index.php?m=member&c=register&a=submit",type:"post",data:{name:c,password:b,code:d},dataType:"json",success:function(f){app.register.status=f.status;app.register.info=f.info;if(e){e.call(this,f)}},error:function(f,g){if(a){a.call(this,g.responseText)}}})}};app.forgot={status:false,info:{},callbacks:[],send:function(d,c,a,b){if(!d||!c){if(b){b.call(this,"用户名和验证码不能为空")}return false}$.ajax({url:"/index.php?m=member&c=forgot&a=send",type:"post",data:{username:d,code:c},dataType:"json",success:function(e){if(a){a.call(this,e)}},error:function(e,f){if(b){b.call(this,f.responseText)}}})},code:function(b){var a="/index.php?m=member&c=forgot&a=code&time="+new Date().getTime();b.attr("src",a)},submit:function(e,c,b,d,a){if(!e||!c||!b){if(a){a.call(this,"用户名、验证码和密码不能为空")}return false}$.ajax({url:"/index.php?m=member&c=forgot&a=submit",type:"post",data:{username:e,safecode:c,password:b},dataType:"json",success:function(f){app.login.status=f.status;app.login.info=f;if(d){d.call(this,f)}},error:function(f,g){if(a){a.call(this,g.responseText)}}})}};app.user={password:{submit:function(b,c,a){if(!app.login.status){if(a){a.call(this,"请先登录！")}return false}b=app.tools.formjson({password0:"",password:""},b);$.ajax({url:"/index.php?m=member&c=password&a=submit",type:"post",data:b,dataType:"json",success:function(d){if(c){c.call(this,d)}},error:function(d,e){if(a){a.call(this,e.responseText)}}})}},photo:{base64:function(d,f,e){if(!app.login.status){if(errorCallback){errorCallback.call(this,"请先登录！")}return false}if(typeof d=="object"&&$(d).is("input[type=file]")){d=app.tools.file2url($(d)[0].files[0])}var c=document.createElement("CANVAS"),a=c.getContext("2d"),b=new Image;b.crossOrigin="Anonymous";b.onload=function(){c.height=b.height;c.width=b.width;a.drawImage(b,0,0);var g=c.toDataURL(e||"image/png");f.call(this,g);c=null};b.src=d},submit:function(c,d,b){if(!app.login.status){if(b){b.call(this,"请先登录！")}return false}if(!c){if(b){b.call(this,"无上传数据")}return false}processData=true;contentType="application/x-www-form-urlencoded";var a=new FormData();if(typeof c=="object"&&$(c).is("input[type=file]")){if(!c.files[0]||!/\.(jpg|png|jpeg|gif)$/i.test($(c).val())){if(b){b.call(this,"上传格式无效")}return false}a.append("photo",c.files[0]);processData=false;contentType=false}else{a={photo:c}}$.ajax({url:"/index.php?m=member&c=photo&a=submit",type:"post",data:a,dataType:"json",processData:processData,contentType:contentType,success:function(e){if(d){d.call(this,e)}},error:function(e,f){if(b){b.call(this,f.responseText)}}})}},info:{code:function(b){if(!app.login.status){return false}var a="/index.php?m=member&c=info&a=code&time="+new Date().getTime();b.attr("src",a)},change:function(b,c,a){if(!app.login.status){if(a){a.call(this,"请先登录！")}return false}b=app.tools.formjson({name:"",code:""},b);$.ajax({url:"/index.php?m=member&c=info&a=change",type:"post",data:b,dataType:"json",success:function(d){if(c){c.call(this,d)}},error:function(d,e){if(a){a.call(this,e.responseText)}}})},send:function(b,c,a){if(!app.login.status){if(a){a.call(this,"请先登录！")}return false}b=app.tools.formjson({mobile:"",email:"",code:""},b);$.ajax({url:"/index.php?m=member&c=info&a=send",type:"post",data:b,dataType:"json",success:function(d){if(c){c.call(this,d)}},error:function(d,e){if(a){a.call(this,e.responseText)}}})},bind:function(b,c,a){if(!app.login.status){if(a){a.call(this,"请先登录！")}return false}b=app.tools.formjson({mobile:"",email:"",safecode:""},b);$.ajax({url:"/index.php?m=member&c=info&a=bind",type:"post",data:b,dataType:"json",success:function(d){if(c){c.call(this,d)}},error:function(d,e){if(a){a.call(this,e.responseText)}}})},submit:function(b,c,a){if(!app.login.status){if(a){a.call(this,"请先登录！")}return false}b=app.tools.formjson({realname:"",aliasname:"",sex:"0",birthday:"",qq:"",address:""},b);$.ajax({url:"/index.php?m=member&c=info&a=submit",type:"post",data:b,dataType:"json",success:function(d){if(c){c.call(this,d)}},error:function(d,e){if(a){a.call(this,e.responseText)}}})}}};app.article={favorite:{checks:function(b,c,a){if(!app.login.status){if(a){a.call(this,"请先登录！")}return false}$.ajax({url:"/index.php?m=article&c=favorite&a=checks",cache:true,type:"post",data:{aids:b},dataType:"json",success:function(d){if(c){c.call(this,d)}},error:function(d,e){if(a){a.call(this,d,e)}}})},add:function(c,b,a){if(!app.login.status){if(a){a.call(this,"请先登录！")}return false}$.ajax({url:"/index.php?m=article&c=favorite&a=add",type:"post",dataType:"json",data:{aid:c},success:function(d){if(b){b.call(this,d)}},error:function(d,e){if(a){a.call(this,e.responseText)}}})},remove:function(c,b,a){if(!app.login.status){if(a){a.call(this,"请先登录！")}return false}$.ajax({url:"/index.php?m=article&c=favorite&a=remove",type:"post",dataType:"json",data:{aid:c},success:function(d){if(b){b.call(this,d)}},error:function(d,e){if(a){a.call(this,e.responseText)}}})}},comment:{check:function(c,b,a){},checks:function(b,c,a){},ding:function(d,a,c,b){},post:function(f,g,c){if(!app.login.status){if(c){c.call(this,"请先登录！")}return false}if(!$(f)[0]){if(c){c.call(this,"上传格式无效")}return false}var b=new FormData();var a=$(f).is("form")?$(f).serializeArray():$(f).find("input:enabled,select:enabled,textarea:enabled").serializeArray();$.each(a,function(){b.append(this.name,this.value)});var e=$(f).find("input[type=file]:enabled");var d=0;$.each(e,function(h){if(/\.(jpg|png|jpeg|gif)$/i.test($(this).val())&&d<5){for(var j=0;j<this.files.length;j++){b.append(this.name,this.files[j]);d++}}});$.ajax({url:"/index.php?m=article&c=comment&a=post",type:"post",data:b,dataType:"json",processData:false,contentType:false,success:function(h){if(g){g.call(this,h)}},error:function(h,i){if(c){c.call(this,i.responseText)}}})}}};app.shop={cart:{data:{},read:function(b,a){$.ajax({url:"/index.php?m=shop&c=cart&a=clac",cache:false,type:"get",dataType:"json",error:function(c,d){if(a){a.call(this,d.responseText)}},success:function(c){if(c.status){app.shop.cart.data=c.data}if(b){b(c)}}})},set:function(b,c,a){b=app.tools.formjson({goods_id:"",product_id:"",goods_num:1},b);$.ajax({url:"/index.php?m=shop&c=cart&a=set",type:"post",dataType:"json",data:b,success:function(d){if(d.status){app.shop.cart.data=d.data}if(c){c.call(this,d)}},error:function(d,e){if(a){a.call(this,e.responseText)}}})},add:function(b,c,a){b=app.tools.formjson({goods_id:"",product_id:"",goods_num:1},b);$.ajax({url:"/index.php?m=shop&c=cart&a=add",type:"post",dataType:"json",data:b,success:function(d){if(d.status){app.shop.cart.data=d.data}if(c){c.call(this,d)}},error:function(d,e){if(a){a.call(this,e.responseText)}}})},remove:function(b,c,a){b=app.tools.formjson({goods_id:"",product_id:""},b);$.ajax({url:"/index.php?m=shop&c=cart&a=delete",type:"get",dataType:"json",data:b,success:function(d){if(d.status){app.shop.cart.data=d.data}if(c){c.call(this,d)}},error:function(d,e){if(a){a.call(this,e.responseText)}}})},update:function(b,c,a){b=app.tools.formjson({goods_id:"",product_id:"",goods_num:1,selected:"",only_goods:true},b);$.ajax({url:"/index.php?m=shop&c=cart&a=update",type:"post",dataType:"json",data:b,success:function(d){if(d.status){app.shop.cart.data=d.data}if(c){c.call(this,d)}},error:function(d,e){if(a){a.call(this,e.responseText)}}})},clac:function(b,c,a){b=app.tools.formjson({address:{id:"",name:"",province:"",city:"",county:"",address:"",mobile:"",phone:"",zip:""},express_id:"",voucher_id:"",invoice:""},b);$.ajax({url:"/index.php?m=shop&c=cart&a=clac",type:"post",dataType:"json",data:b,success:function(d){if(d.status){app.shop.cart.data=d.data}if(c){c.call(this,d)}},error:function(d,e){if(a){a.call(this,e.responseText)}}})},submit:function(b,c,a){if(!app.login.status){if(a){a.call(this,"请先登录！")}return false}b=app.tools.formjson({address:{id:"",name:"",province:"",city:"",county:"",address:"",mobile:"",phone:"",zip:""},express_id:"",voucher_id:"",invoice:"",invoice_title:"",memo:[]},b);$.ajax({url:"/index.php?m=shop&c=cart&a=submit",type:"post",dataType:"json",data:b,success:function(d){if(c){c.call(this,d)}},error:function(d,e){if(a){a.call(this,e.responseText)}}})}},address:{area:function(c,b,a){$.ajax({url:"/index.php?m=shop&c=area&a=json",type:"get",dataType:"json",data:{pid:c},success:function(d){if(b){b.call(this,d)}},error:function(d,e){if(a){a.call(this,e.responseText)}}})},submit:function(b,c,a){if(!app.login.status){if(a){a.call(this,"请先登录！")}return false}b=app.tools.formjson({id:"",name:"",province:"",city:"",county:"",address:"",mobile:"",phone:"",zip:"","default":""},b);$.ajax({url:"/index.php?m=shop&c=address&a=save",type:"post",dataType:"json",data:b,success:function(d){if(c){c.call(this,d)}},error:function(d,e){if(a){a.call(this,e.responseText)}}})}},order:{notify:function(c,b,a){if(!app.login.status){if(a){a.call(this,"请先登录！")}return false}$.ajax({url:"/index.php?m=shop&c=order&a=notify",type:"get",dataType:"json",data:{order:c},success:function(d){if(b){b.call(this,d)}},error:function(d,e){if(a){a.call(this,e.responseText)}}})},comment:function(f,g,c){if(!app.login.status){if(c){c.call(this,"请先登录！")}return false}if(!$(f)[0]){if(c){c.call(this,"上传格式无效")}return false}var b=new FormData();var a=$(f).is("form")?$(f).serializeArray():$(f).find("input:enabled,select:enabled,textarea:enabled").serializeArray();$.each(a,function(){b.append(this.name,this.value)});var e=$(f).find("input[type=file]:enabled");var d=0;$.each(e,function(h){if(/\.(jpg|png|jpeg|gif)$/i.test($(this).val())&&d<5){for(var j=0;j<this.files.length;j++){b.append(this.name,this.files[j]);d++}}});$.ajax({url:"/index.php?m=shop&c=order&a=comment",type:"post",data:b,dataType:"json",processData:false,contentType:false,success:function(h){if(g){g.call(this,h)}},error:function(h,i){if(c){c.call(this,i.responseText)}}})}},voucher:{submit:function(c,b,a){if(!app.login.status){if(a){a.call(this,"请先登录！")}return false}$.ajax({url:"/index.php?m=shop&c=voucher&a=submit",type:"post",data:c,dataType:"json",success:function(d){if(b){b.call(this,d)}},error:function(d,e){if(a){a.call(this,e.responseText)}}})},remove:function(b,c,a){if(!app.login.status){if(a){a.call(this,"请先登录！")}return false}$.ajax({url:"/index.php?m=shop&c=voucher&a=remove",type:"post",data:{voucher_id:b},dataType:"json",success:function(d){if(c){c.call(this,d)}},error:function(d,e){if(a){a.call(this,e.responseText)}}})}}};